---
title: "Charlotte Protest Topics"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
# Load libraries needed
library(flexdashboard); library(tidyverse); library(plotly); library(stm); library(scales); library(shinyWidgets);
# Load the input file
load(file = "tweet_topic_df.RData")
# Convert IDs to numeric
tweet_topic_df$id <- as.numeric(tweet_topic_df$id)
# Get the topic names in an array
topicsNames <- tail(colnames(tweet_topic_df), 40)
#tweet_topic_df$id[0]
```

### Inputs

```{r}
# Set input for the topic
selectInput("topicNum", label = "1st Topic", #multiple = TRUE,
    choices = topicsNames,
    selected = c("release + wife + video + released + releases"))
# Set input for the x-range
sliderInput("xaxis", label = "X Range",
            min = 0, max = 1, value = 0.2, step = 0.05)
# Set input for the y-range
sliderInput("yaxis", label = "Y Range",
            min = 0, max = 300, value = 120, step = 0.05)
# Set input for the adjustment
sliderInput("adjust", label = "Adjustment",
            min = 0, max = 20, value = 3, step = 0.5)
# Set input for the bin width
#sliderInput("histogramBin", label = "Histogram Bin",
#            min = 0, max = 0.1, value = 0.01, step = 0.001)
# Set input for choosing the graph type: histogram or density
# switchInput(inputId = "Histogram", value = TRUE, width = '500px')
```

```{r}
# Call renderPlotly
renderPlotly({
  # Select the column which correspond to the topic choice
  #selected_topic <- input$topicNum
  #t <- tweet_topic_df[topicsNames[input$topicNum]]
  # Construct the ggplot for that topic using Gaussian as the kernel density
  g <- ggplot(tweet_topic_df, aes(x = input$topicNum)) +
  #g <- ggplot(t, aes(x = input$topicNum)) +
  geom_density(kernel = "gaussian", adjust = input$adjust) +
  theme(legend.position = c(0.5,0.75)) +
  xlim(0,input$xaxis) +
  ylim(0,input$yaxis)
  # Use ggplotly to plot the ggplot
  ggplotly(g, tooltip = c("y","x","colour"))
})
```

<!-- ### DataTable -->

<!-- ```{r} -->
<!-- #https://plot.ly/r/shiny-coupled-events/ -->
<!-- # Call renderDataTable from DT library -->
<!-- DT::renderDataTable({ -->
<!--   # Set the event listener -->
<!--   event.data <- event_data("plotly_relayout") -->
<!--   # Set the max and min according to the event -->
<!--   min <- event.data$`xaxis.range[0]` -->
<!--   max <- event.data$`xaxis.range[1]` -->
<!--   # Get the row numbers -->
<!--   row <- df$row[df[,c(input$topicNum)]< max & df[,c(input$topicNum)]> min] -->
<!--   # Select the rows in tweet_id_body and make a tibble out of it -->
<!--   t <- tibble(tweet = tweet_id_body$body[row],  -->
<!--               ScreenName = tweet_id_body$screenName[row],  -->
<!--               Probability = round(tweet_id_body[row,input$topicNum], 3)) -->
<!--   # Create a datatable from the   -->
<!--   DT::datatable(t, options = list(pageLength = 7, dom = 'tip'), rownames = FALSE) -->
<!-- }) -->
<!-- ``` -->
